anchors:
  patches:
    machineBase: &machineBase |
      debug: false
      machine:
        kubelet:
          nodeIP:
            validSubnets:
              - 10.10.10.0/24
        time:
          disabled: true
    controlplaneCluster: &controlplaneCluster |
      cluster:
        etcd:
          image: registry.k8s.io/etcd:v3.6.6
          advertisedSubnets:
            - 10.10.10.0/24
    controlplane: &controlplanePatches
      - *machineBase
      - *controlplaneCluster
    worker: &workerPatches
      - *machineBase

  machineDefaults: &machineDefaults
    platform: hcloud
    variant: metal
    apply-config-via-userdata: false
    hcloud:
      serverType: cax11

  controlplaneDefaults: &controlplaneDefaults
    <<: *machineDefaults
    type: controlplane
    configPatches: *controlplanePatches

  workerDefaults: &workerDefaults
    <<: *machineDefaults
    type: worker
    configPatches: *workerPatches

name: hcloud-ha-go
kubernetesVersion: v1.31.0
usePrivateNetwork: true
privateNetwork: 10.10.10.0/24
privateSubnetwork: 10.10.10.0/25
machines:
  - <<: *controlplaneDefaults
    id: controlplane-1
    type: init
    privateIP: 10.10.10.5
  - <<: *controlplaneDefaults
    id: controlplane-2
    privateIP: 10.10.10.2
  - <<: *controlplaneDefaults
    id: controlplane-3
    privateIP: 10.10.10.10
  - <<: *workerDefaults
    id: worker-1
    privateIP: 10.10.10.3
