# Research: Pulumi Stash

**Source**: https://www.pulumi.com/docs/iac/concepts/stash/
**Date**: 2026-01-13

## Summary
The Pulumi `Stash` resource is a mechanism for state management that allows saving values to a stack's state for later retrieval. 

**Key Features:**
*   **Persistence**: It takes an input value and makes it available as an output property. This output remains stateful and retains the original input even if the input property is updated in subsequent deployments.
*   **Secrets Handling**: It can handle complex and secret values. Secrets are encrypted in the stack's state.
*   **Updates**: Updating a stashed value requires replacing the resource (targeting for replacement, tainting, or using `TriggerReplacement`).

## Relevance to talosctl Migration
This concept (or resource) could be highly relevant for the "Drop pulumiverse" migration, specifically for:

1.  **Persisting Configs**: Storing `talosconfig` and `kubeconfig` derived from the cluster bootstrap process. Since we are moving to `talosctl`, we might generate these configs once and need to "stash" them in the Pulumi state so they are available for subsequent runs without regenerating them (which would change certs/secrets).
2.  **State Migration**: If we are removing the `pulumiverse` provider, we lose the state it managed. `Stash` could be a way to "adopt" or "save" critical values (like the cluster endpoint or initial admin secrets) into the generic Pulumi state before removing the provider.
3.  **Idempotency**: It supports the requirement (FR-007) to avoid unintended regeneration of secrets/configs.

## Action Items
*   Verify if `Stash` is a core Pulumi resource, a part of the `command` provider, or a pattern using `export`.
*   Prototype using `Stash` (or the equivalent `command` resource) to persist a `talosconfig` generated by `talosctl gen config`.
